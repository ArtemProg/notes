## Table View



Помимо отдельного вью, существует еще и вью контроллер UITableViewController. Контроллер табличного представления – это элемент, объединяющий в себе вью контроллер, табличное представление `TableView`, делегат `UITableViewDelegate` и источник данных `UITableViewDataSource` табличного представления.



### Источник данных

```swift
extension ViewController: UITableViewDataSource {}
```

Протокол `UITableViewDataSource` требует, чтобы в классе были реализованы два метода:

- `numberOfRowsInSection`, возвращающий общее количество строк в секции таблицы; каждая секция может содержать произвольное количество строк
- `cellForRowAt`, возвращающий экземпляр ячейки для конкретной строки таблицы.

```swift
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    let cell = UITableViewCell(style: .default, reuseIdentifier: "contactCellIdentifier")
    var configuration = cell.defaultContentConfiguration()
    configuration.text = "Строка \(indexPath.row)"
    cell.contentConfiguration = configuration
    return cell
}
```



### Свайпы

При свайпе по таблице вызывается один из двух методов делегата (в зависимости от того, в какую сторону происходит свайп):

- `trailingSwipeActionsConfigurationForRowAt` - при свайпе влево
- `leadingSwipeActionsConfigurationForRowAt` - при свайпе в право

```swift
extension ViewController: UITableViewDelegate {}
```

```swift
func tableView(_ tableView: UITableView, trailingSwipeActionsConfigurationForRowAt indexPath: IndexPath) -> UISwipeActionsConfiguration? {

  let actionDelete = UIContextualAction(style: .destructive, title: "Удалить") { _,_,_ in
      self.contacts.remove(at: indexPath.row)
      tableView.reloadData()
  }

  let action = UISwipeActionsConfiguration(actions: [actionDelete])

  return action
}
```



### Нажатие

Метод `UITableViewDelegate.tableView(_:didSelectRowAt:)` Срабатывает при нажатии на строку таблицы.





### Секции

Для каждой секции может быть определен текст, отображаемый в ее верхней части — так называемый заголовок секции. Метод `titleForHeaderInSection` позволяет на основании индекса секции указать текстовый заголовок, который будет выводиться над секцией.

```swift
override func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -> String? {
    var title: String?
    let tasksType = sectionsTypesPosition[section]
    if tasksType == .important {
        title = "Важные"
    } else if tasksType == .normal {
        title = "Текущие"
    }
    return title
}
```



### Обновление

reloadData

Метод `UITableView.reloadSections(_:with:)` Обновляет указанные секции табличного представления.



### Режим редактирования

Для работы с режимом редактирования используется свойство `isEditing`, определяющее, находится ли элемент в режиме редактирования. Когда значение свойства isEditing изменяется, происходит автоматический вызов метода `setEditing` данного табличного представления.

Наличие свойства isEditing и метода setEditing в классе вью контроллера позволяет полностью контролировать процесс перевода сцены и ее отдельных элементов в режим редактирования.

Особенно полезным режим редактирования является в случае использования контроллера табличного представления. При переходе в режим редактирования Table View Controller также автоматически переводит в этот режим и Table View.

Источник данных (Data Source) табличного представления позволяет произвести настройки режима редактирования табличного представления.

Метод `UITableViewDataSource.tableView(_:canEditRowAt:) -> Bool` Определяет возможность редактирования конкретной строки в табличном представлении. По умолчанию, если метод не реализован, все строки считаются редактируемыми.

Метод `UITableViewDataSource.tableView(_:editingStyleForRowAt:) -> UITableViewCell.EditingStyle` Определяет стиль иконки, отображаемой в строке в режиме редактирования. Если данный метод не определен, то по умолчанию для всех редактируемых строк используется стиль .delete (красный круг).

Метод `UITableViewDataSource.tableView(_:commit:forRowAt:)` Обрабатывает нажатие на иконку редактирования в строке.

Метод `UITableViewDataSource.tableView(_:canMoveRowAt:) -> Bool` Определяет возможность изменения позиции строки в табличном представлении.По умолчанию позиция любой строки в табличном представлении может быть изменена, поэтому, если ваш проект не предполагает другой логики, нет никакой необходимости в реализации метода `canMoveRowAt`, возвращающего `true` для всех строк таблицы.

Для того, чтобы в таблице появились индикаторы перемещения, в источнике данных необходимо реализовать метод moveRowAt, который вызывается после окончания перемещения строки, то есть сразу после того, как пользователь переместил строку на новую позицию и отпустил палец.

Метод `UITableViewDataSource.tableView(_:moveRowAt:to:)` Вызывается при изменении позиции строки с `moveRowAt` на `to`.



В состав класса `UIViewController` входит особое свойство `editButtonItem` типа `UIBarButtonItem`, с помощью которого на сцену (посредством программного кода) можно добавить кнопку активации/деактивации режима редактирования. При нажатии на нее вью контроллер автоматически переходит в режим редактирования, при этом текст кнопки соответствующим образом изменяется (в кнопке будет отображено `Edit` или `Done`, в зависимости от текущего значения свойства `isEditing` контроллера).

Класс UITableViewController, на котором основана сцена нашего приложения, является дочерним по отношению к UIViewController, а значит также имеет в своем составе свойство editButtonItem. Соответственно, при использовании кнопки из данного свойства в режим редактирования будет переводиться не только контроллер, но и входящее в его состав табличное представление.

```swift
override func viewDidLoad() {
  super.viewDidLoad()
  // кнопка активации режима редактирования
  navigationItem.leftBarButtonItem = editButtonItem
}
```

