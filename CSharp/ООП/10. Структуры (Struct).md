## Структуры (Struct)



Структуры могут содержать конструкторы, константы, поля, методы, свойства, индексаторы, операторы, события и вложенные типы.

Структуры могут реализовывать интерфейсы, но они не могут наследоваться от структур или классов, поскольку уже наследуются не явно от абстрактного класса `ValueType`.



В структурах нельзя инициализировать поля непосредственно в месте создания.

```c#
struct MyStruct
{
    public int field;
    // public int field = 1; // Приведет к ошибке уровня компиляции
}

// Создание экземпляра структурного типа, без вызова конструктора.
MyStruct instance;

// Обращение на чтение к значению не инициализированной переменной приведет к ошибке компиляции.
// Console.WriteLine(instance.field);

instance.field = 1;
Console.WriteLine(instance.field);
```



Если в структуре имеются члены, которые обращаются к полю и нет пользовательского конструктора, то требуется при создании экземпляра вызывать конструктор по умолчанию, иначе будет ошибка.

```c#
struct MyStruct
{
    private int field;
    
    public int Field
    {
        get { return field; }
        set { field = value; }
    }
    
    public void Show()
    {
        Console.WriteLine(field);
    }
}

// Создание экземпляра структурного типа с вызовом конструктора по умолчанию.
MyStruct instance = new MyStruct();
instance.Show();
C
instance.field = 1;
Console.WriteLine(instance.field);
```



Конструкторы по умолчанию нельзя задавать явно.

```c#
struct MyStruct
{
    // public MyStruct() {} // Приведет к ошибке уровня компиляции
}
```



Если в структуре имеется пользовательский конструктор, то требуется в нем инициализировать все поля.

```c#
struct MyStruct
{
	public int field;
    public MyStruct(int value)
    {
    	field = value;
    }
}
```



Структура не может быть статической, но может содержать статические члены. Инициализация статических полей не обязательна.

Статический конструктор всегда работает в связке с пользовательским конструктором. Статический конструктор всегда отрабатывает первый.

```c#
struct MyStruct
{
	public int field;
    
    static MyStruct()
    {
        Console.WriteLine("Static Constructor");
    }
    
    public MyStruct(int value)
    {
        Console.WriteLine("Constructor");
    	field = value;
    }
}

// Статический конструктор не вызовется
MyStruct instance1 = new MyStruct() { field = 555 };

// Сначала вызовется статический конструктор, потом пользовательский
MyStruct instance2 = new MyStruct(333) { field = 555 };

```



В структурах можно создавать автоматически реализуемые свойства, при этом требуется использовать конструктор при построении экземпляра.

```c#
struct MyStruct
{
    public int MyProperty { get; set; }
}

MyStruct instance1 = new MyStruct();
Console.WriteLine(instance.MyProperty);
```



Если структуры расположить в массиве, то они будут размещены на куче.

Экземпляр структурного типа располагается на куче если он представлен как член класса.

В стеке, экземпляр структурного типа, будет размещен только в том случае если он представлен локальной переменной метода, в остальных случаях структура будет размещена на куче.