## Модальные страницы



В некоторых случаях, прежде чем уйти со страницы, требуется дождаться, пока пользователь выполнит определенное действие. Допустим, пользователь вводит информацию в форму. В такой ситуации вы можете потребовать, чтобы пользователь *сохранил* или *отменил* изменения, прежде чем покинуть страницу.

Возможности навигации для *модальной* страницы ограничены: прежде чем перейти на другую страницу, пользователь должен указать, что работа с текущей страницей завершена. Модальные страницы хорошо подходят в тех случаях, когда требуется получить ответ от пользователя.

Модальные страницы представлены в любом существующем пользовательском интерфейсе. При работе с ними доступ к базовому пользовательскому интерфейсу блокируется до тех пор, пока не будет закрыто модальное содержимое. Как правило, при использовании модального содержимого пользователь должен выполнить с ним определенные действия.



### Переход с использованием модальных страниц

В Xamarin.Forms модальные страницы также хранятся в стеке, который похож на стек навигации, но не зависит от него. Благодаря наличию второго стека возможно отображение нескольких страниц в модальном режиме.

В отличие от стека навигации, для которого требуется объект `NavigationPage`, модальный стек доступен всегда. Страница может быть отображена в модальном режиме в любое время, независимо от общей структуры навигации приложения.

```c#
public interface INavigation
{
    ...
    IReadOnlyList<Page> ModalStack { get; }
    Task PushModalAsync(Page page);
    Task<Page> PopModalAsync();

    IReadOnlyList<Page> NavigationStack { get; }
    Task PushAsync(Page page);
    Task<Page> PopAsync();
}
```

`PushModalAsync` используется для отображения страницы в модальном режиме, а `PopModalAsync` позволяет закрыть модальную страницу.



### Вызов методов модальной навигации

```c#
public class AlarmsPage : ContentPage
{  ...
    async void OnEditClick(...) {
        await Navigation.PushModalAsync(new EditPage());
    }
}
```

Чтобы закрыть модальную страницу, вызовите `Navigation.PopModalAsync`.

```c#
public class EditPage : ContentPage
{
    ...
    async void OnSaveClick  (...) {
        ...
        await Navigation.PopModalAsync();
    }
    async void OnCancelClick(...) {
        ...
        await Navigation.PopModalAsync();
    }
}
```



### Обработка функций кнопок "Назад" устройства

В некоторых устройствах предусматривается аппаратная или реализуемая системой кнопка "Назад". С помощью такой кнопки можно закрыть модальную страницу и обойти код в методах `OnSaveClick` или `OnCancelClick`. При этом пользователь не будет точно знать, какие именно действия были выполнены при нажатии этой кнопки. Будут ли изменения сохранены или отменены?

Чтобы решить эту проблему, можно переопределить метод `OnBackButtonPressed` страницы `Page`. Переопределение этого метода позволяет выполнять необходимые действия перед закрытием страницы. Какие именно действия будут выполнены, решаете вы. Можно реализовать некоторое поведение по умолчанию, а также предположить, что пользователь хотел сохранить введенные данные или отменить изменения. Что именно будет выполняться, зависит от приложения.

```c#
public partial class EditContactPage : ContentPage
{
    ...
    protected override bool OnBackButtonPressed()
    {
        ...
    }
}
```

