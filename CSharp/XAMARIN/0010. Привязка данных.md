

## Привязка данных

[ms learn](https://docs.microsoft.com/ru-ru/learn/modules/separate-your-ui-and-code-with-xamarin-forms-data-binding/2-use-databinding-in-xamarin-forms)



Объект *binding* связывает два свойства. Одно свойство находится в пользовательском интерфейсе, а другое — в объекте модели данных. При изменении значения любого из этих свойств объект привязки может обновлять другое свойство. Другими словами, привязки — это промежуточные объекты, которые синхронизируют ваши данные и пользовательский интерфейс. Термины *исходный* и *целевой* мы используем для определения двух участвующих объектов.

Правила для исходного и целевого объекта различаются:

- **Источник**. Источник: может быть объектом любого типа. На практике в качестве исходного объекта обычно используется объект данных C#. Для участия в привязке вам нужно определить свойство для этого исходного объекта. Свойство определяется путем задания `Path` в привязке.
- **Целевой объект**. Целевой объект должен быть производным от `BindableObject`. Целевое свойство должен быть реализовано с помощью специального свойства с именем `BindableProperty`. Все элементы управления Xamarin.Forms в конечном счете являются производными от `BindableObject` (через `View`). Их свойства в основном являются `BindableProperties`. Такая архитектура обеспечивает использование всех элементов управления Xamarin.Forms в качестве удобных целевых объектов привязки.



### Создание привязок данных в XAML

Пример привязки в XAML с помощью расширения разметки `{Binding}`

```xaml
<!-- In XAML our bindings do not need to set Source -->
<StackLayout Padding="20" Spacing="20">
    <StackLayout.Resource>
        <ResourceDictionary>
            <Todo x:Kye="getMilk" Title="Pickup some Milk" />
        </ResourceDictionary>
    </StackLayout.Resource>
    <Entry Text="{Binding Title, Source={StaticResource getMilk}}" />
</StackLayout>
```

Для исходного объекта:

- Объект создается в словаре ресурсов страницы с `Key` из `getMilk`.
- Значение параметра `Path` — `Title`.

Для целевого объекта:

- Объект является элементом управления `Entry`.
- Свойство имеет значение `Text`.

При загрузке этого файла XAML расширение разметки `{Binding}` создает привязку между `Todo` и `Entry`. Объект привязки считывает `Todo.Title` и загружает значение в `Entry.Text`.



### Создание привязок данных в коде

Этот метод может быть удобен при динамическом создании пользовательского интерфейса.

```c#
// Create Source
ToDo task = new ToDo() { Title = "Pickup some Milk", ... };

// Create target
Entry Name = new Entry();

// Create binding, identifying Source and Path
Binding nameBinding = new Binding()
nameBinding.Source = task;
nameBinding.Path = "Title";

// Set Binding, identifying Target object and Target property
Name.SetBinding(Entry.TextProperty, nameBinding);
```



### Использование одного источника для нескольких привязок

Класс `BindableObject` определяет свойство с именем `BindingContext`. Все страницы, панели макета и элементы управления Xamarin.Forms наследуют от `BindableObject`, таким образом, данное свойство есть у всех этих элементов.

При создании привязки параметр `Source` является необязательным. Привязка без параметра для `Source` автоматически ищет в визуальном дереве свойства `BindingContext`, значение которых отлично от NULL.

```xaml
<Picker x:Name="country" />
```

```c#
private void InitializeData()
{
    // country.SelectedItem = CurrentFlag.Country;
    // country.SelectedIndexChanged += (s, e) => CurrentFlag.Country = repository.Countries[country.SelectedIndex];
    country.BindingContext = CurrentFlag;
    country.SetBinding(Picker.SelectedItemProperty, new Binding(nameof(CurrentFlag.Country)));
    ...
}
```



`BindingContext`, как правило, задается на уровне страницы. Наши привязки XAML содержат только исходный путь, что помогает уменьшить размеры кода XAML и сделать его более удобным для чтения.

```c#
// In code-behind we set Page.BindingContext
BindingContext = new Todo() { Title = "Pickup some milk", Notes = "Stop at the Grocery Store!", Completed = true }
```

```xaml
<!-- In XAML our bindings do not need to set Source -->
<StackLayout Padding="20" Spacing="20">
    <Entry Text="{Binding Title}" />
    <Entry Text="{Binding Notes}" />
    <Switch IsToggled="{Binding Completed}" />
</StackLayout>
```

Привязки отслеживают изменения в *ссылке на объект* своего источника. Эта функция работает даже для привязок, использующих `BindingContext` в качестве источника. Если `Source` или `BindingContext` переназначается другому объекту, привязка получает данные из нового источника и обновляет целевой объект.

