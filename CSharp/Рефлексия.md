## Рефлексия



Рефлексия (отражение) - это процесс, во время которого программа может отслеживать и модифицировать собственную структуру и поведение во время выполнения.

Парадигма программирования, положенная в основу отражения, называется рефлексивным программированием. Это один из видов метапрограммирования.

`System.Reflection` - пространство имен, которое содержит классы для применения рефлексии.



### Класс Type

Type является корневым классом для функциональных возможностей рефлексии и основным способом доступа к метаданным.

С помощью членов класса Type можно получить сведения об объявленных в типе элементах: конструкторах, методах, полях, свойствах и событиях класса, а также о  модуле и сборке, в которых развернут данный класс.



Способы получения экземпляра класса `Type`:

- Вызов метода `GetType()` на экземпляре требуемого класса.
- Вызов статического метода `GetType()` класса `Type`.
- Использование оператора `typeof()`.

Результатом будет ссылка на объект `Type`, содержащий информацию о целевом типе.



Пример вызова закрытого метода и записи в закрытое поле:

```c#
MyClass instance = new MyClass();
Type type = instance.GetType();

// Вызов private метода
MethodInfo methodC = type.GetMethod("MethodC", BindingFlags.Instance | BindingFlags.NonPublic);
methodC.Invoke(instance, new object[] { "Hello", " world"!});

// Запись значения в private поле
FieldInfo mystring = type.GetField("mystring", BindingFlags.Instance | ...);
mystring.SetValue(instance, "Привет мир!");
```



### Класс Assembly

Класс Assembly представляет сборку, которая является модулем с возможностью многократного использования, поддержкой версий и встроенным механизмом описания общеязыковой исполняющей среды.

*Однофайловая сборка.* Все компоненты сборки хранятся в одном файле.

*Многофайловая сборка.* Метаданные сборки обязательно должны находится в главном файле. Метаданные типов, код и ресурсы могут храниться как в главном файле сборки, так и во вспомогательных файлах.

Метаданные сборки (Манифест) состоят из описания сборки: имя, версия, строгое имя, информация о культуре.

Метаданные типов включают пространство имен и имя типа, члены типа и параметры, если имеются.

Байт-код (псевдокод) - машинно-независимый код низкого уровня, генерируемый транслятором и исполняемый интерпретатором.

Ресурсы - это объекты, которые используются кодом: строки, изображения, различные файлы.



### Класс Activator

Класс Activator содержит методы для локального создания типов объектов.

Метод `CreateInstance()` создает экземпляр типа, определенного в сборке путем вызова конструктора, который наилучшим образом соответствует заданным аргументам.

```c#
Assembly assembly = null;

try
{
    assembly = Assembly.Load("CarLibrary");
}
catch (FileNotFoundExeption e)
{
    Console.WriteLine(e.Message);
}

Type type = assembly.GetType("CarLibrary.MiniVan");

// Создание экземпляра типа во время выполнения, используя технику позднего связывания
object instance = Activator.CreateInstance(type);

// Получение экземпляра класса MethodInfo для метода Acceleration
MethodInfo method = type.GetMethod("Acceleration");

// Вызов метода Acceleration
method.Invoke(instance, null);
```

